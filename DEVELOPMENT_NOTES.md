# GSAP动画全栈开发指南 - 开发笔记

本文档记录在开发"GSAP动画全栈开发指南"VitePress项目过程中遇到的各种问题与解决方案，以帮助团队成员理解项目开发历程并提供技术参考。

## 目录

- [配置问题](#配置问题)
  - [VitePress代码高亮配置错误](#vitepress代码高亮配置错误)
- [导航问题](#导航问题)
  - [顶部导航高亮状态丢失](#顶部导航高亮状态丢失)
  - [侧边栏标题与内容不一致](#侧边栏标题与内容不一致)
- [组件问题](#组件问题)
  - [GsapEditor组件模板字符串解析错误](#gsapeditor组件模板字符串解析错误)
  - [Vue模板选择器解析错误](#vue模板选择器解析错误)
- [样式问题](#样式问题)
- [性能问题](#性能问题)
- [兼容性问题](#兼容性问题)

## 配置问题

### VitePress代码高亮配置错误

**问题描述：**  
在配置VitePress时，遇到TypeScript错误：`对象字面量只能指定已知属性，并且"shiki"不在类型"UserConfig<Config>"中`。

**原因分析：**  
这是由于VitePress 2.0版本对代码高亮配置方式的变更导致。早期版本中，shiki配置是作为顶级配置项单独存在，而在新版本中，这种配置方式已不再支持。

**解决方案：**  
移除顶级的`shiki`配置，仅保留必要的markdown配置：

```js
// 错误配置
shiki: {
  theme: {
    light: 'github-light',
    dark: 'github-dark'
  }
}

// 正确配置
markdown: {
  linkify: false,
  // 可选：如果需要自定义主题
  theme: {
    light: 'github-light',
    dark: 'github-dark'
  }
}
```

**学习要点：**
- VitePress配置API随版本更新有变化
- 需关注官方文档中的Breaking Changes
- 代码高亮功能在VitePress中由Shiki提供支持，即使不显式配置也会使用默认主题

## 导航问题

### 顶部导航高亮状态丢失

**问题描述：**  
当点击顶部导航后，对应项目正确高亮；但随后点击侧边栏任意项目时，顶部导航的高亮状态会被清除，导致用户可能无法判断当前所浏览内容属于哪个主要分类。

**原因分析：**  
VitePress默认只在完全匹配路径时高亮导航项。当用户点击侧边栏项目后，当前URL变为子页面路径，不再完全匹配顶部导航项的路径，从而导致高亮状态丢失。

**解决方案：**  
为顶部导航项添加`activeMatch`属性，使用正则表达式匹配所有子页面路径：

```js
nav: [
  { text: '首页', link: '/' },
  { text: '基础篇', link: '/basics/', activeMatch: '^/basics/' },
  { text: 'Vue3集成', link: '/vue-integration/', activeMatch: '^/vue-integration/' },
  // 其他导航项...
]
```

**学习要点：**
- VitePress的`activeMatch`属性允许使用正则表达式定义更灵活的高亮规则
- 导航状态对用户体验至关重要，应确保用户始终知道自己在站点中的位置
- 正则表达式`^/section/`表示匹配所有以"/section/"开头的路径

### 侧边栏标题与内容不一致

**问题描述：**  
侧边栏菜单中的项目标题"选择器与对象操作"与实际内容页面的标题"选择器与DOM操作"不一致，导致用户体验混乱。

**原因分析：**  
在开发过程中，内容文件的标题进行了优化和调整，但忘记同步更新config.ts中的侧边栏配置，导致两处命名不一致。

**解决方案：**  
修改VitePress配置文件中的侧边栏标题，使其与实际内容保持一致：

```js
// docs/.vitepress/config.ts
sidebar: {
  '/basics/': [
    {
      text: 'GSAP基础篇',
      items: [
        // ...
        { text: '选择器与DOM操作', link: '/basics/selectors' }, // 修改此处
        // ...
      ]
    }
  ],
  // ...
}
```

**学习要点：**
- 保持导航标题与内容标题的一致性对用户体验至关重要
- 内容命名变更时应同步更新所有相关配置
- 定期检查网站导航与实际内容的一致性

## 组件问题

### GsapEditor组件模板字符串解析错误

**问题描述：**  
在使用自定义GsapEditor组件时，当initialJs属性中包含多个空行或特殊字符（如转义引号）时，Vue模板解析失败，导致页面无法正常加载。

**原因分析：**  
GsapEditor组件使用模板字符串(\`\`)传递JavaScript代码，而这种嵌套多层引号和特殊字符的情况容易导致Vue模板解析错误。特别是属性选择器中使用转义引号(`[data-animation=\"bounce\"]`)和代码中的空行会触发解析问题。

**解决方案：**  
为GsapEditor组件建立了严格的代码规范：

1. 禁止在代码块中使用空行，改用注释分隔代码块：
```vue
<!-- 错误 -->
<GsapEditor :initialJs="`
gsap.to('.box', {
  x: 100,
  
  y: 50
});`" />

<!-- 正确 -->
<GsapEditor :initialJs="`
gsap.to('.box', {
  x: 100,
  // 使用注释分隔
  y: 50
});`" />
```

2. 属性选择器中避免使用转义引号：
```vue
<!-- 错误 -->
<GsapEditor :initialJs="`gsap.to('[data-animation=\"bounce\"]', {});`" />

<!-- 正确 -->
<GsapEditor :initialJs="`gsap.to('[data-animation=bounce]', {});`" />
```

3. 将相关规范添加到项目的cursorrules.md文档中，以确保团队一致遵循。

**学习要点：**
- Vue模板中嵌套的模板字符串需要特别注意字符转义问题
- 在复杂组件中建立明确的语法规则非常必要
- 即使是有效的JavaScript语法，在模板字符串中也可能导致解析问题
- 文档化问题与解决方案有助于团队成员避免同样的错误

### Vue模板选择器解析错误

**问题描述：**  
在selectors.md文件中，添加调试与常见问题解决部分后，页面渲染出现"Whitespace was expected"错误，位于第380行附近。

**原因分析：**  
Vue的模板编译器在解析Markdown中嵌入的HTML元素时非常严格。问题出在列表格式上，特别是嵌套列表项的缩进和空格处理上。Markdown中的列表项与Vue的模板解析规则有时会产生冲突。

**解决方案：**  
将问题部分从使用数字列表格式改为使用标题格式，确保HTML结构的一致性：

```markdown
<!-- 原来的问题格式 -->
1. **选择器匹配不到元素**
   - 使用控制台验证...
   - 检查元素...

<!-- 修改后的格式 -->
### 问题1：选择器匹配不到元素

- 使用控制台验证...
- 检查元素...
```

这种方式避免了嵌套列表中可能出现的空格和缩进问题，使Vue模板解析器能够正确处理内容。

**学习要点：**
- Markdown与Vue模板语法混合使用时需谨慎
- 复杂的嵌套列表结构可能导致Vue模板解析错误
- 使用更简单的HTML结构可以避免解析问题
- 当遇到难以定位的模板错误时，尝试替换可能的问题结构

## 样式问题

*（待记录项目中遇到的样式相关问题）*

## 性能问题

*（待记录项目中遇到的性能相关问题）*

## 兼容性问题

*（待记录项目中遇到的兼容性相关问题）*

---

## 贡献指南

欢迎团队成员在开发过程中遇到新问题时，按照以下格式添加到本文档中：

```
### 问题简短描述

**问题描述：**  
详细描述问题的表现和影响。

**原因分析：**  
分析问题产生的技术原因。

**解决方案：**  
提供解决问题的具体步骤或代码示例。

**学习要点：**
- 从这个问题中学到的关键技术点
- 相关的最佳实践
- 可能需要注意的陷阱
```

请确保内容清晰、准确，并添加适当的代码示例和参考链接。 