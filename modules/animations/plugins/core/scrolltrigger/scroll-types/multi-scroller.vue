<template>
  <GsapEditor 
    title="å¤šé‡æ»šåŠ¨å™¨æ•ˆæœ"
    :initialHtml="htmlCode"
    :initialCss="cssCode"
    :initialJs="jsCode"
    scrollHeight="650px"
  />
</template>

<script setup>
const htmlCode = `<div class="dual-scroll-container">
  <div class="intro">
    <h2>å¤šé‡æ»šåŠ¨å™¨ç¤ºä¾‹</h2>
    <p>ScrollTriggerå¯ä»¥ç›‘æ§å¤šä¸ªç‹¬ç«‹çš„æ»šåŠ¨åŒºåŸŸ</p>
    <div class="instruction">ğŸ‘‰ åˆ†åˆ«æ»šåŠ¨å·¦å³ä¸¤ä¸ªé¢æ¿æŸ¥çœ‹æ•ˆæœ</div>
  </div>
  
  <div class="panels-container">
    <!-- å·¦ä¾§é¢æ¿ -->
    <div class="scroll-panel left-panel">
      <h3 class="panel-title">å·¦ä¾§æ»šåŠ¨åŒºåŸŸ</h3>
      <div class="scroll-content">
        <div class="scroll-item box1">é¡¹ç›® 1</div>
        <div class="scroll-item box2">é¡¹ç›® 2</div>
        <div class="scroll-item box3">é¡¹ç›® 3</div>
        <div class="scroll-item box4">é¡¹ç›® 4</div>
        <div class="scroll-item box5">é¡¹ç›® 5</div>
        <div class="scroll-item box6">é¡¹ç›® 6</div>
        <div class="scroll-item box7">é¡¹ç›® 7</div>
      </div>
      <div class="progress-bar left-progress"></div>
    </div>
    
    <!-- å³ä¾§é¢æ¿ -->
    <div class="scroll-panel right-panel">
      <h3 class="panel-title">å³ä¾§æ»šåŠ¨åŒºåŸŸ</h3>
      <div class="scroll-content">
        <div class="scroll-item box5">é¡¹ç›® A</div>
        <div class="scroll-item box4">é¡¹ç›® B</div>
        <div class="scroll-item box3">é¡¹ç›® C</div>
        <div class="scroll-item box2">é¡¹ç›® D</div>
        <div class="scroll-item box1">é¡¹ç›® E</div>
        <div class="scroll-item box6">é¡¹ç›® F</div>
        <div class="scroll-item box7">é¡¹ç›® G</div>
      </div>
      <div class="progress-bar right-progress"></div>
    </div>
  </div>
</div>`;

const cssCode = `* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Arial', sans-serif;
  background-color: #f8f9fa;
  color: #333;
}

.dual-scroll-container {
  max-width: 100%;
  margin: 0 auto;
  padding: 15px;
}

.intro {
  margin-bottom: 20px;
  background-color: #fff;
  border-radius: 8px;
  padding: 15px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  text-align: center;
}

.intro h2 {
  margin-bottom: 10px;
  color: #333;
  font-size: 20px;
}

.intro p {
  color: #666;
  margin-bottom: 10px;
}

.instruction {
  display: inline-block;
  background-color: #fff3cd;
  color: #856404;
  padding: 8px 12px;
  border-radius: 4px;
  margin-top: 10px;
  font-size: 14px;
  animation: pulse 2s infinite;
}

.panels-container {
  display: flex;
  gap: 20px;
  height: 450px;
}

.scroll-panel {
  flex: 1;
  background-color: #fff;
  border-radius: 8px;
  box-shadow: 0 3px 6px rgba(0,0,0,0.1);
  position: relative;
  overflow: hidden;
}

.panel-title {
  padding: 12px;
  background-color: #f8f8f8;
  border-bottom: 1px solid #eee;
  text-align: center;
  font-size: 16px;
  position: sticky;
  top: 0;
  z-index: 10;
  transition: background-color 0.3s ease;
}

.scroll-content {
  height: calc(100% - 44px);
  overflow-y: auto;
  padding: 15px;
  position: relative;
  -webkit-overflow-scrolling: touch; /* æé«˜iOSæ»šåŠ¨æ€§èƒ½ */
}

.scroll-item {
  margin-bottom: 20px;
  padding: 30px 20px;
  border-radius: 6px;
  color: white;
  text-align: center;
  font-size: 18px;
  font-weight: bold;
  will-change: transform, opacity;
  position: relative;
  box-shadow: 0 3px 10px rgba(0,0,0,0.1);
}

.scroll-item.active {
  box-shadow: 0 8px 25px rgba(0,0,0,0.2);
}

.scroll-item.active:after {
  content: 'âœ“';
  position: absolute;
  top: 10px;
  right: 10px;
  background: rgba(255,255,255,0.3);
  width: 20px;
  height: 20px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 12px;
}

.box1 { background: linear-gradient(135deg, #667eea, #764ba2); }
.box2 { background: linear-gradient(135deg, #2af598, #009efd); }
.box3 { background: linear-gradient(135deg, #f6d365, #fda085); }
.box4 { background: linear-gradient(135deg, #ff9a9e, #fad0c4); }
.box5 { background: linear-gradient(135deg, #a18cd1, #fbc2eb); }
.box6 { background: linear-gradient(135deg, #4facfe, #00f2fe); }
.box7 { background: linear-gradient(135deg, #43e97b, #38f9d7); }

.progress-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 4px;
  width: 0;
  background: linear-gradient(to right, #0984e3, #6c5ce7);
  z-index: 20;
}

@keyframes pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.05); }
  100% { transform: scale(1); }
}`;

const jsCode = `// æ³¨å†ŒScrollTriggeræ’ä»¶
gsap.registerPlugin(ScrollTrigger);

// æ¸…é™¤å¯èƒ½å­˜åœ¨çš„ScrollTriggerå®ä¾‹
ScrollTrigger.getAll().forEach(st => st.kill());

// è®¾ç½®å…¨å±€é»˜è®¤å€¼
ScrollTrigger.defaults({
  markers: false // ç¡®ä¿æ‰€æœ‰å®ä¾‹é»˜è®¤ä¸æ˜¾ç¤ºæ ‡è®°
});

// åˆå§‹åŒ–å‡½æ•°
function initScrollPanels() {
  // åˆ›å»ºå…¥åœºåŠ¨ç”»
  const tl = gsap.timeline();
  tl.from('.intro', { y: -20, opacity: 0, duration: 0.6 })
    .from('.scroll-panel', { x: function(i) { return i ? 20 : -20 }, opacity: 0, stagger: 0.2, duration: 0.5 });

  // åˆå§‹åŒ–å·¦ä¾§é¢æ¿
  initPanel('.left-panel', '.left-progress');
  
  // åˆå§‹åŒ–å³ä¾§é¢æ¿
  initPanel('.right-panel', '.right-progress');
}

// åˆå§‹åŒ–æ»šåŠ¨é¢æ¿
function initPanel(panelSelector, progressSelector) {
  const panel = document.querySelector(panelSelector);
  if (!panel) return;
  
  const scrollContent = panel.querySelector('.scroll-content');
  const progressBar = panel.querySelector(progressSelector);
  const items = panel.querySelectorAll('.scroll-item');
  
  // é¢„è®¾åŠ¨ç”»çŠ¶æ€
  gsap.set(items, { 
    opacity: 0.5, 
    y: 20, 
    scale: 0.95,
    transformOrigin: 'center'
  });
  
  // ä¸ºæ¯ä¸ªé¡¹ç›®åˆ›å»ºScrollTrigger
  items.forEach((item, index) => {
    // åˆ›å»ºæ›´æ˜æ˜¾çš„åŠ¨ç”»æ•ˆæœ
    const itemAnim = gsap.timeline({ paused: true })
      .to(item, { 
        opacity: 1, 
        y: 0, 
        scale: 1,
        duration: 0.4,
        ease: "back.out(1.3)"
      });
    
    // åˆ›å»ºScrollTriggerä»¥æ§åˆ¶åŠ¨ç”»
    ScrollTrigger.create({
      trigger: item,
      scroller: scrollContent,
      start: "top 75%", // å½“é¡¹ç›®é¡¶éƒ¨åˆ°è¾¾è§†å£75%ä½ç½®æ—¶è§¦å‘
      end: "bottom 25%", // å½“é¡¹ç›®åº•éƒ¨åˆ°è¾¾è§†å£25%ä½ç½®æ—¶ç»“æŸ
      onToggle: (self) => {
        if(self.isActive) {
          itemAnim.play();
          item.classList.add('active');
        } else {
          itemAnim.reverse();
          item.classList.remove('active');
        }
      },
      id: \`item-\${index}\`,
      markers: false
    });
  });
  
  // åˆ›å»ºè¿›åº¦æ¡æ»šåŠ¨åŠ¨ç”»
  ScrollTrigger.create({
    scroller: scrollContent,
    start: "top top",
    end: "bottom bottom",
    onUpdate: self => {
      gsap.to(progressBar, {
        width: \`\${self.progress * 100}%\`,
        duration: 0.1
      });
    },
    markers: false
  });
  
  // ç›‘å¬æ»šåŠ¨å†…å®¹ï¼Œæ›´æ–°çŠ¶æ€æ–‡æœ¬
  scrollContent.addEventListener('scroll', function() {
    // è·å–panelä¸­çš„æ‰€æœ‰æ´»åŠ¨å…ƒç´ 
    const activeItems = panel.querySelectorAll('.scroll-item.active');
    panel.querySelector('.panel-title').innerText = 
      \`\${panelSelector.includes('left') ? 'å·¦ä¾§' : 'å³ä¾§'}åŒºåŸŸ - æ´»åŠ¨é¡¹: \${activeItems.length}\`;
  });
}

// ç¡®ä¿DOMåŠ è½½å®Œæ¯•ååˆå§‹åŒ–
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', initScrollPanels);
} else {
  initScrollPanels();
}
`;
</script>